PRAGMA foreign_keys = ON;

-- ===============================
-- BANCO DE DADOS: URNA ELETRÔNICA
-- ===============================

CREATE TABLE Administrador (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    usuario TEXT UNIQUE NOT NULL,
    senha TEXT NOT NULL,
    matricula TEXT UNIQUE NOT NULL,
    email_institucional TEXT NOT NULL,
    master INTEGER DEFAULT 0
);

CREATE TABLE Eleicao (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    titulo TEXT NOT NULL,
    data_inicio DATE NOT NULL,
    data_fim DATE NOT NULL,
    status INTEGER DEFAULT 1
);

CREATE TABLE Cargo (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    nome TEXT NOT NULL,
    descricao TEXT
);

CREATE TABLE Chapa (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    nome TEXT NOT NULL,
    slogan TEXT,
    numero TEXT,
    logo TEXT
);

CREATE TABLE Candidato (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    nome TEXT NOT NULL,
    cargo_id INTEGER NOT NULL,
    chapa_id INTEGER,
    FOREIGN KEY (cargo_id) REFERENCES Cargo(id),
    FOREIGN KEY (chapa_id) REFERENCES Chapa(id)
);

CREATE TABLE Voto (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    chapa_id INTEGER NOT NULL,
    eleicao_id INTEGER NOT NULL,
    FOREIGN KEY (chapa_id) REFERENCES Chapa(id),
    FOREIGN KEY (eleicao_id) REFERENCES Eleicao(id)
);

CREATE TABLE Cedula (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    eleicao_id INTEGER NOT NULL,
    data_emissao DATETIME NOT NULL,
    FOREIGN KEY (eleicao_id) REFERENCES Eleicao(id)
);

CREATE TABLE Resultado (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    eleicao_id INTEGER NOT NULL,
    chapa_id INTEGER NOT NULL,
    total_votos INTEGER NOT NULL,
    FOREIGN KEY (eleicao_id) REFERENCES Eleicao(id),
    FOREIGN KEY (chapa_id) REFERENCES Chapa(id)
);

-- INTERMEDIO ENTRE ELEICAO E CHAPA:

CREATE TABLE EleicaoChapa (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    eleicao_id INTEGER NOT NULL,
    chapa_id INTEGER NOT NULL,
    FOREIGN KEY (eleicao_id) REFERENCES Eleicao(id),
    FOREIGN KEY (chapa_id) REFERENCES Chapa(id),
    UNIQUE (eleicao_id, chapa_id)
);

-- ===============================
-- DADOS FICTÍCIOS PARA TESTE
-- ===============================

-- Administrador
INSERT INTO Administrador (usuario, senha, matricula, email_institucional, master)
VALUES ('limeira', 'tesi25', '2025001', 'limeira@ufac.br', 1),
        ('root', 'root', 'root', 'root', '1');

-- Eleição
INSERT INTO Eleicao (titulo, data_inicio, data_fim)
VALUES ('Eleição CASI 2025', '2025-10-01', '2025-10-05');

-- Cargos
INSERT INTO Cargo (nome, descricao) VALUES
('Presidente', 'Responsável geral pelo Centro Acadêmico'),
('Vice-Presidente', 'Substitui o presidente quando necessário'),
('Diretor de Cultura', 'Coordena atividades culturais e eventos');

-- Chapas
INSERT INTO Chapa (nome, slogan, logo) VALUES
('Core 2 Quad', 'Renovar com atitude', '/images/core2quad.png'),
('Nova Ordem', 'Juntos pelo futuro', '/images/nova_ordem.png');

-- Candidatos
INSERT INTO Candidato (nome, cargo_id, chapa_id) VALUES
('Ana Souza', 1, 1),
('Bruno Silva', 1, 2),
('Carla Mendes', 2, 1),
('Diego Ramos', 2, 2),
('Eduardo Lima', 3, 1);

-- Associação entre eleição e chapas
INSERT INTO EleicaoChapa (eleicao_id, chapa_id) VALUES
(1, 1),
(1, 2);
