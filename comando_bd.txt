-- ===============================
-- BANCO DE DADOS: URNA ELETRÔNICA
-- ===============================

CREATE TABLE Administrador (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    usuario TEXT UNIQUE NOT NULL,
    senha TEXT NOT NULL -- ou hash?
);

CREATE TABLE Eleicao (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    titulo TEXT NOT NULL,
    data_inicio DATE NOT NULL,  -- formato: YYYY-MM-DD
    data_fim DATE NOT NULL,
    administrador_id INTEGER NOT NULL,
    FOREIGN KEY (administrador_id) REFERENCES Administrador(id)
);

CREATE TABLE Cargo (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    nome TEXT NOT NULL,
    descricao TEXT
);

CREATE TABLE Chapa (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    nome TEXT NOT NULL,
    slogan TEXT,
    logo TEXT, -- endereço da imagem
    administrador_id INTEGER NOT NULL,
    FOREIGN KEY (administrador_id) REFERENCES Administrador(id)
);

CREATE TABLE Candidato (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    nome TEXT NOT NULL,
    cargo_id INTEGER NOT NULL,
    chapa_id INTEGER,
    FOREIGN KEY (cargo_id) REFERENCES Cargo(id),
    FOREIGN KEY (chapa_id) REFERENCES Chapa(id)
);

CREATE TABLE Eleitor (
    matricula INTEGER PRIMARY KEY AUTOINCREMENT,
    nome TEXT NOT NULL,
    email_institucional TEXT NOT NULL,
    verificado INTEGER DEFAULT 0  -- 0 = falso, 1 = verdadeiro
);

CREATE TABLE Voto (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    chapa_id INTEGER NOT NULL,
    eleitor_matricula INTEGER NOT NULL,
    eleicao_id INTEGER NOT NULL,
    FOREIGN KEY (chapa_id) REFERENCES Chapa(id),
    FOREIGN KEY (eleitor_matricula) REFERENCES Eleitor(matricula),
    FOREIGN KEY (eleicao_id) REFERENCES Eleicao(id)
);

CREATE TABLE Cedula (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    eleicao_id INTEGER NOT NULL,
    eleitor_matricula INTEGER NOT NULL,
    data_emissao DATE NOT NULL, -- formato: YYYY-MM-DD HH:MM:SS
    FOREIGN KEY (eleicao_id) REFERENCES Eleicao(id),
    FOREIGN KEY (eleitor_matricula) REFERENCES Eleitor(matricula)
);

-- Tabela opcional para guardar resultados consolidados
CREATE TABLE Resultado (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    eleicao_id INTEGER NOT NULL,
    chapa_id INTEGER NOT NULL,
    total_votos INTEGER NOT NULL,
    FOREIGN KEY (eleicao_id) REFERENCES Eleicao(id),
    FOREIGN KEY (chapa_id) REFERENCES Chapa(id)
);
